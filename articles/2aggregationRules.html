<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2. Rules of Aggregation • mscatch</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="2. Rules of Aggregation">
<meta property="og:description" content="mscatch">
<meta property="og:image" content="https://noaa-edab.github.io/mscatch/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mscatch</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/mscatch.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/1dataNeeds.html">1. Data Requirements</a>
    </li>
    <li>
      <a href="../articles/2aggregationRules.html">2. Rules of Aggregation</a>
    </li>
    <li>
      <a href="../articles/3catchExpansion.html">3. Catch Expansion</a>
    </li>
    <li>
      <a href="../articles/4notes.html">Notes</a>
    </li>
    <li>
      <a href="../articles/underlyingRules.html">Underlying Rules</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/NOAA-EDAB/mscatch/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="2aggregationRules_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="2aggregationRules_files/kePrint-0.0.1/kePrint.js"></script><link href="2aggregationRules_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>2. Rules of Aggregation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NOAA-EDAB/mscatch/blob/HEAD/vignettes/2aggregationRules.Rmd" class="external-link"><code>vignettes/2aggregationRules.Rmd</code></a></small>
      <div class="hidden name"><code>2aggregationRules.Rmd</code></div>

    </div>

    
    
<p>After <a href="articles/1dataNeeds.html">pulling the data</a> (length sample data and the landings data) for a particular species a user can now use <a href="reference/aggregate_landings.html"><code>mscatch::aggregate_landings()</code></a> to aggregate the landings and the length data. All decision points are written to a <a href="logExample.html">logfile</a> for the user to inspect.</p>
<div class="section level2">
<h2 id="gear">Gear<a class="anchor" aria-label="anchor" href="#gear"></a>
</h2>
<p>Gear is defined using the field NEGEAR which characterizes gear by a three character code. A list of gear types with their codes and descriptions can be found using <code>comlandr::get_gears()</code></p>
<ul>
<li>This step ignores time (YEAR, QTR), MARKET_CODE, and length distributions and looks at aggregated landings by gear type to determine dominant gear types in fishery. The resulting number of distinct gear types to be selected is controlled by a user defined parameter indicating the total percentage of landings to be accounted for by distinct gear types. (Others lumped in <strong>otherGear</strong> category)</li>
</ul>
<p>For example, using a value of 95% would select the gear types, when ordered by each gears landings, for which the cumulative sum &gt; 95% of total landings. All other gear types (those comprising &lt; 5% of total landings) would be combined into an <strong>otherGear</strong> category. Below, the gear types (050,010,110) would be retained. All other gear types would be lumped together.</p>
<table class="table">
<thead><tr>
<th style="text-align:left;">
# NEGEAR
</th>
<th style="text-align:right;">
Landings
</th>
<th style="text-align:right;">
Cumulative
</th>
<th style="text-align:right;">
Percentage
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;color: green !important;">
050
</td>
<td style="text-align:right;color: green !important;">
1141407667
</td>
<td style="text-align:right;color: green !important;">
1141407667
</td>
<td style="text-align:right;color: green !important;">
0.8285119
</td>
</tr>
<tr>
<td style="text-align:left;color: green !important;">
010
</td>
<td style="text-align:right;color: green !important;">
95196644
</td>
<td style="text-align:right;color: green !important;">
1236604311
</td>
<td style="text-align:right;color: green !important;">
0.8976121
</td>
</tr>
<tr>
<td style="text-align:left;color: green !important;">
100
</td>
<td style="text-align:right;color: green !important;">
93069581
</td>
<td style="text-align:right;color: green !important;">
1329673892
</td>
<td style="text-align:right;color: green !important;">
0.9651684
</td>
</tr>
<tr>
<td style="text-align:left;color: #d3d3d3 !important;">
020
</td>
<td style="text-align:right;color: #d3d3d3 !important;">
30155056
</td>
<td style="text-align:right;color: #d3d3d3 !important;">
1359828948
</td>
<td style="text-align:right;color: #d3d3d3 !important;">
0.9870570
</td>
</tr>
<tr>
<td style="text-align:left;color: #d3d3d3 !important;">
056
</td>
<td style="text-align:right;color: #d3d3d3 !important;">
9405172
</td>
<td style="text-align:right;color: #d3d3d3 !important;">
1369234120
</td>
<td style="text-align:right;color: #d3d3d3 !important;">
0.9938839
</td>
</tr>
<tr>
<td style="text-align:left;color: #d3d3d3 !important;">
132
</td>
<td style="text-align:right;color: #d3d3d3 !important;">
1773276
</td>
<td style="text-align:right;color: #d3d3d3 !important;">
1371007396
</td>
<td style="text-align:right;color: #d3d3d3 !important;">
0.9951711
</td>
</tr>
<tr>
<td style="text-align:left;color: #d3d3d3 !important;">
057
</td>
<td style="text-align:right;color: #d3d3d3 !important;">
1630702
</td>
<td style="text-align:right;color: #d3d3d3 !important;">
1372638098
</td>
<td style="text-align:right;color: #d3d3d3 !important;">
0.9963548
</td>
</tr>
<tr>
<td style="text-align:left;color: #d3d3d3 !important;">
160
</td>
<td style="text-align:right;color: #d3d3d3 !important;">
1462198
</td>
<td style="text-align:right;color: #d3d3d3 !important;">
1374100296
</td>
<td style="text-align:right;color: #d3d3d3 !important;">
0.9974161
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="market-category">Market Category<a class="anchor" aria-label="anchor" href="#market-category"></a>
</h2>
<p>Market categories are defined by the field MARKET_CODE which characterizes market codes by a two character code. A list of market codes for a species can be found using <code>comlandr::get_species_itis()</code></p>
<ul>
<li><p>Any MARKET_CODEs that do not have any length samples (aggregated over YEAR, QTR) are treated first. The user has the option to aggregate these market codes with any other market code. The default option is to relabel these as unknowns, “UN”. Often these MARKET_CODEs have a small amount of landings attributed to them and the impact of this aggregation is negligible</p></li>
<li><p>The length distributions for the remaining MARKET_CODEs (aggregated over YEAR, QTR) are then tested against each other (using the Kolmogorov-Smirnov) to determine if they are significantly different. Any MARKET_CODEs that are found to be statistically insignificant are aggregated.</p></li>
<li><p><strong>Future development: Include option to do this for each YEAR</strong></p></li>
</ul>
<p>The user has the option of stopping at this point. The data returned will either be at the QTR or YEAR level depending on user inputs.</p>
</div>
<div class="section level2">
<h2 id="time">Time<a class="anchor" aria-label="anchor" href="#time"></a>
</h2>
<p>The user supplies the level in which landings should be aggregated, (YEAR, QTR, or a MIX of the two). <strong>Future development: Include SEMESTER option</strong>. All combinations of Time, NEGEAR, MARKET_CODE that do not have associated length samples borrow samples from the nearest neighbor based on time. <strong>Future development: Include nearest neighbor based on spatial units and/or GEAR</strong></p>
<p>The borrowing of length samples from one time interval to use in another time interval can be a subjective process that differs among species based on life history traits. To complicate matters length distributions sampled within MARKET_CODEs may have shifted over time. These issues will be dealt with at a future date. A generalized method is currently applied (<strong>Future development: Include additional options based on life history traits and fishing industry changes</strong>)</p>
<ul>
<li>Aggregate all to QTRs and borrow length samples where necessary</li>
<li>Aggregate all to YEAR and borrow length samples where necessary</li>
<li>A MIX of both YEAR and QTR</li>
</ul>
<div class="section level4">
<h4 id="year">YEAR<a class="anchor" aria-label="anchor" href="#year"></a>
</h4>
<p>The following are performed sequentially:</p>
<ul>
<li><p>The landings and length sample data are aggregated over QTR to the the annual (YEAR) level</p></li>
<li><p>For each gear type (NEGEAR) the Kolmogorov-Smirnov test is applied in each YEAR (<strong>Future work</strong>) to test for differences in the length distributions among MARKET_CODEs. Any MARKET_CODEs with length distributions found to be statistically insignificant can be aggregated by the user. The default is no aggregation of MARKET_CODEs.</p></li>
<li><p>For each gear type (NEGEAR) and market code: A YEAR with missing length samples borrows length samples from the YEAR closest to it in time (in the future or the past)</p></li>
<li><p>For any NEGEAR/MARKET_CODE combinations where the number of length samples is less than the user defined value (<code>nLengthSamples</code>), for all YEARS then length samples are borrowed from another NEGEAR type with the same MARKET_CODE. Samples are borrowed from the NEGEAR with the most landings (since is is assumed they will have the most length samples). If there are insufficient length samples, the next NEGEAR in order of total landings is checked. And so on.</p></li>
<li><p>The sampling program for most species started several years after landings were first recorded. So there is a stretch of consecutive years in the early part of the time series without any length samples. These years are assigned length samples from the first year in which samples were taken.</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="qtr">QTR<a class="anchor" aria-label="anchor" href="#qtr"></a>
</h4>
<ul>
<li><p>For YEARs where there are landings before any length samples were taken all YEAR/QTRs are assigned the length samples from the most first YEAR in which length samples were taken (from the same QTR)</p></li>
<li><p>For YEARs when QTRs have missing length samples the previous years length samples for the same QTR are assigned. If there are not length samples in the previous year then the process is repeated until a length sample is available. If this still results in no length samples then the nearest neighbor is used. Length samples from the nearest QTR (any QTR) are used. If this still results in no length samples then the nearest neighbor is used from the NEGEAR type that is attributed with the majority of the landings.</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="mix">MIX<a class="anchor" aria-label="anchor" href="#mix"></a>
</h4>
<ul>
<li>A tolerance for the allowed proportion of missing length samples by QTR (for each NEGEAR and MARKET_CODE) is used to determine if length samples should be assigned to ALL QTRs (as described by the methods above) or whether landings should be aggregated to annual data.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="other-gear">other GEAR<a class="anchor" aria-label="anchor" href="#other-gear"></a>
</h2>
<p>In all methods above the <code>otherGear</code> category is by definition sparse. This gear type is always aggregated to annual data.</p>
</div>
<div class="section level2">
<h2 id="unclassified-market-code">Unclassified Market Code<a class="anchor" aria-label="anchor" href="#unclassified-market-code"></a>
</h2>
<p>In all methods above the landings and length sample data for the unclassified market category, <code>UN</code>, is aggregated to the same level as other MARKET_CODEs.</p>
<p>The unclassified landings for a specific (YEAR, QTR, NEGEAR) are assumed to be a mixture of fish lengths similar to that in the observed MARKET_CODEs. Therefore the length distribution for the unclassified landings are assumed to have the same distribution as the length distributions of the landed fish in all of the known market codes combined.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Andy Beet, Laurel Smith, Sean Lucey.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
