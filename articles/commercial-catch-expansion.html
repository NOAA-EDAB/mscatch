<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Commercial catch expansion • mscatch</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Commercial catch expansion">
<meta property="og:description" content="mscatch">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mscatch</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/commercial-catch-expansion.html">Commercial catch expansion</a>
    </li>
    <li>
      <a href="../articles/data_notes.html">Data Notes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/NOAA-EDAB/mscatch/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="commercial-catch-expansion_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Commercial catch expansion</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NOAA-EDAB/mscatch/blob/master/vignettes/commercial-catch-expansion.Rmd"><code>vignettes/commercial-catch-expansion.Rmd</code></a></small>
      <div class="hidden name"><code>commercial-catch-expansion.Rmd</code></div>

    </div>

    
    
<div id="gen" class="section level1">
<h1 class="hasAnchor">
<a href="#gen" class="anchor"></a>General overview</h1>
<ol style="list-style-type: decimal">
<li>From “RAW” landings data (mv_cf_landings, AA t/s tables) we need to:</li>
</ol>
<ul>
<li>Assign all missing areas and/or assign all trips to an EPU</li>
<li>10 min square designations exist in mv_cf_landings from 1994 onward. (Sean, Mike presentation in 2010 “Ecosystem – Based Fishery Management for the New England Fishery Management Council: Part Deux: Spatial Considerations” shows landings by gear type from 1998-2009. Expanding to earlier years might not be possible.) So then how get landings to EPU for earlier years? If use trip characteristics to do this we are assuming the fishery has remained somewhat constant over time. Is this realistic? What to do?</li>
<li>missing gear type can be dealt with in length expansion. (Assume unknowns have proportional make up of the known gear types)</li>
<li>Aggregate landings by year, quarter, gear, market category, stat area assigned to proper ecoregion:</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>From “RAW” length data (mv_cf_len, LEN AA tables) we need to</li>
</ol>
<ul>
<li>Determine the number of length samples and total number of lengths by year, quarter, gear, market category, stat area assigned to proper ecoregion. (G.S -“Summarize biological samples by year, gear, quarter, market category, stat area. Compare to landings.”)</li>
<li>Assign AREA to EPU. (May need to try and link “trip” to landings data after EPUs assigned to determin EPU)</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><p>Then merge both data sets. This will be the starting dataset needed for the following rules by G.S.</p></li>
<li><p>Now start to <em>Combine</em> cells to increase sample sizes or <em>interpolate</em> individual missing cells?</p></li>
</ol>
<p>For example: the data should be in this format (mv_cf_landings: species_itis = 164744, Haddock): <img src="figures/head164744dat.PNG" width="100%"></p>
<p>where,</p>
<p><strong>landings_land</strong> = total landings for YEAR,QTR,NEGEAR,MARKET_CODE</p>
<p><strong>landings_nn</strong> = number of “trips” associated with landings</p>
<p><strong>len_numLengthSamples</strong> = number of trips where length samples were (unique <strong>tripid</strong>)</p>
<p><strong>len_totalNumLen</strong> = Total number of fish sampled in these trips (from table below).</p>
<p>NA indicates no data</p>
<p>with the length data in this format (mv_cf_len):</p>
<p><img src="figures/head164744len.PNG" width="65%"></p>
<p>where,</p>
<p><strong>tripid</strong> = id for a trip where samples were taken</p>
<p><strong>LENGTH</strong> = length of a sampled fish</p>
<p><strong>NUMLEN</strong> = number of fish sampled for stated <strong>LENGTH</strong> in a given <strong>tripid</strong></p>
<ol start="5" style="list-style-type: decimal">
<li>Obtain length-weight data (from SVDBS) and fit length-weight relationship (or get param values from database svdbs.LENGTH_WEIGHT_COEFFICIENTS)</li>
</ol>
<p><span class="math display">\[ W_i = \alpha L_i ^ \beta e^{z_i}\]</span></p>
<p>for fish i, where <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are intercept and slope parameters (on log scale) and <span class="math inline">\(z_i \sim N(0,\sigma^2)\)</span></p>
<p>This model can be extended to :</p>
<p><span class="math display">\[ W_{ji} = \alpha L_{ji} ^ {\beta_j} e^{z_i} \]</span> for season j, j= 1, …, 4 (spring, summer, fall, winter) or sex j, j = 1, …, 3 (0, 1, 2 categories) or extended further to include season:sex combinations. These models are all nested and can therefore be tested using standard statistical methods.</p>
<ol start="6" style="list-style-type: decimal">
<li>Apply length-weight relationship to length distributions and split aggregated landings accordingly. All unclassified landings are then expanded using a similar method. See the <a href="#expand">method for expanding lengths</a> section below.</li>
</ol>
</div>
<div id="rules-of-aggregation" class="section level1">
<h1 class="hasAnchor">
<a href="#rules-of-aggregation" class="anchor"></a>Rules of aggregation</h1>
<p>To determine “similar length distributions” we could use the two sample Kolmogorov-Smirnov test. The test compares empirical CDF’s. We would construct the empirical CDF from the histogram of length’s (over all samples) at 1 cm intervals. Use stats::ks.test. Many ties - may need to perform a randomization test</p>
<p>In many stock assessments each year may result in a different level of aggregation (i.e quarters, semesters or different gear types). For the first pass here we will use the same aggregation level for all years. Maybe a good exercise to compare results.</p>
<p>Note: minimum number of length samples ~ 1 per 200 metric tonnes landed. (unwritten rule of thumb, check )</p>
<p>(Within each year, t)</p>
<div id="combine" class="section level2">
<h2 class="hasAnchor">
<a href="#combine" class="anchor"></a>Combine:</h2>
<ul>
<li>
<p>Are there <em>gear</em> types with total landings greater than 0 but total sample sizes less than <em>X</em>? This step ignores time (YEAR, QTR) and MARKET_CODE and looks at aggregated landings by gear type to determine dominant gear types in fishery. Number of distinct gear types controlled by a parameter indicating the % of landings to be accounted for by distinct gear types. (Others lumped in <em>otherGear</em> category)</p>
<pre><code>  + if YES: Combine gear types (explore to see if combined lengths similar) to increase sample size or Ignore and continue (add to total at the end).
  + if NO: Count your blessings and continue.  </code></pre>
</li>
<li>
<p>Are there <em>market categories</em> (they are not on ordinal scale) with total landings greater than 0 but sample sizes less than <em>X</em>? (after combining gears). If there are market categories with length samples &lt; <em>X</em> the user must decide which categories to combine. Often these MARKET_CODEs have small landings. We then compare length distributions (Kolmogorov-Smirnov test) of remaining MARKET_CODES to determine further aggregation. Currently this is done by aggregating length samples over YEAR and QTR. (This can and should be relaxed at a later date)</p>
<pre><code>+ if YES: combine market categories with similar length distributions. 
+ if NO : Count your blessings and continue.  </code></pre>
</li>
<li><p>Are there <em>quarters</em> with landings but sample sizes less than <em>X</em>? A threshold for percentage missing samples “allowed” is implemented. For each NEGEAR/MARKET_CODE combo we determine, for each QTR, the number years that have length samples. The mean of this is used as a measure of “completeness” (The ~# years with samples). If this mean exceeds a user defined threshold then we borrow length sample data for missing QTRs from the previous years equivalent QTR. (If this is also missing we look back another year and so on). If the mean falls below the defined threshold (too many missing length samples at QTR level) the data is aggregated to the YEARly level and we follow a similar process. However prior to aggregation we test (ks-test) for differences in length distributions among market categories. If distributions are sig different we do not aggregate MARKET_CODEs and proceed. Otherwise MARKET_CODEs are aggregated - not complete yet. The YEARs with missing length samples borrow from the closest YEAR with length samples (either direction). In most cases length sampling began at a point in time after landings were recorded. For the YEARs with landings prior the length sampling start date we borrow length samples either by QTR or by YEAR (as explained above) from the most recent YEAR with length samples.</p></li>
</ul>
<p>NOTE: <strong>This has been simplified until we can figure out how to deal with unclassifieds. The user decides if aggregation (for all MARKET_CODEs) occurs at QTR or annual level. UNclassified samples are then aggregated in a similar fashion to allow easier expansion of UN lengths. The otherGear category is ALWAYS aggregated to annual data. If there are no length samples in previous year(s), same quarter, we resort to nearest neighbor. If no samples exist at all, we borrow from another gear type, nearest neighbor </strong></p>
<pre><code>  + if YES: Create semesters?  (Currently semesters are skipped and jump straight to annual)
  + if NO: Count your blessings and continue.  
  </code></pre>
<ul>
<li>
<p>Are there <em>strata</em> with landings but sample sizes less than <em>X</em>? We have one <em>strata</em> (EPU) so this is skipped (Code can be generalized to include this. Rules will need to be made as to where to borrow from and when)</p>
<pre><code>+ If YES: define groups of similar strata  
+ If NO: Count your blessings and continue.  </code></pre>
</li>
<li>
<p>Interpolate remaining holes.</p>
<pre><code>+ Select length within year/market category from adjacent strata or strata group (after determining if appropriate).  
+ Select length within year/market category from adjacent quarter or semester (after determining if appropriate).  
+ Select length within year/market category from adjacent year (after determining if appropriate).  </code></pre>
</li>
<li>
<p>If unclassified market category and no other information available: If length samples are available they are used for the given YEAR,NEGEAR otherwise the distribution is assumed to be that of all observed MARKET_CODEs</p>
<pre><code>+ Combine market category samples to create an unclassified  
+ Use appropriate observer length samples to apply to unclassified. </code></pre>
</li>
<li>
<p>If holes remain</p>
<pre><code>+ Calculate ratio of sampled to un-sampled landings and expand total length frequency such that expanded sample weight equals total landings weight for year t.</code></pre>
</li>
</ul>
</div>
<div id="interpolate-only" class="section level2">
<h2 class="hasAnchor">
<a href="#interpolate-only" class="anchor"></a>Interpolate only:</h2>
<p>If examination of sample matrix shows only sporadic missing cells with landings but sample sizes less than <em>X</em>:</p>
<ul>
<li>
<p>Samples by year/gear/quarter/stat area/market category</p>
<pre><code>+ Nearest stat area within market category/quarter/gear/year  
    + Keeping year/market category constant:  
        + Adjacent quarter/ same stat area  
            + Adjacent quarter/ any stat area within ecoregion  
                + Adjacent semester/matching stat area  
                    + Adjacent semester/ any stat area within ecoregion  
                      +  If lengths by gear are similar: Alternative gear/same quarter/stat area  
                            + Alternative gear/same quarter/any stat area
                                + Alternative gear/semester/same stat area
                                    + Alternative gear/semester/any stat area
                                        + No options- extrapolate to total</code></pre>
</li>
</ul>
<p><em>Or combination of both approaches</em></p>
</div>
<div id="vocabulary" class="section level2">
<h2 class="hasAnchor">
<a href="#vocabulary" class="anchor"></a>Vocabulary</h2>
<p>Definitions to think about.</p>
<ul>
<li>
<p>Area - could be stock area or EPU</p>
<pre><code>+ Stat area - smallest unit that the landings are reported to 
+ Stock area - stock assessment footprint (combined stat areas)
+ EPU - ecological production unit</code></pre>
</li>
<li>
<p>Time - quarter, semester, annual</p>
<pre><code>+ Quarter - 3 month
+ Semester - 6 month
+ Annual - 12 month</code></pre>
</li>
<li>
<p>Length - market categories, cm,</p>
<pre><code>+ Market categories - could vary over port, time, </code></pre>
</li>
</ul>
</div>
<div id="expand" class="section level2">
<h2 class="hasAnchor">
<a href="#expand" class="anchor"></a>Method to expand lengths</h2>
<div id="known-market-codes" class="section level3">
<h3 class="hasAnchor">
<a href="#known-market-codes" class="anchor"></a>Known market codes</h3>
<p>For each unique category (YEAR, QTR, NEGEAR, MARKET_CODE) we have both total landings (metric tons) and a sample of fish lengths for this category. The sampled fish lengths are converted to weights using the <a href="#gen">weight-length relationship</a> found in the gerneral overview. The resulting sample fish weights are mean weights (metric tons). The weight distribution of sampled fish is then scaled to the weight of total landings. This scaling assumes that the landed (commercial) fish have the same length distribution as the sampled fish.</p>
<p>For each unique category we define</p>
<p><span class="math display">\[expansion \; factor = \frac{total \; landings}{\sum sampled \; fish \; weigths} \]</span> Therefore the expanded weights of the sample (to meet the total landings)</p>
<p><span class="math display">\[expanded \; sample\; weights \; = expansion \; factor \;*\; sampled \; fish \; weights\]</span></p>
</div>
<div id="unclassified-market-code" class="section level3">
<h3 class="hasAnchor">
<a href="#unclassified-market-code" class="anchor"></a>Unclassified market code</h3>
<p>The unclassified landings for a specific (YEAR, QTR, NEGEAR) are assumed to be a mixture of fish lengths similar to that in the observed MARKET_CODEs. Therefore the length distribution for the unclassified landings are assumed to have the same distribution as the length distributions of the landed fish in all of the known market codes combined. The sampled fish lengths (from the known market codes) are converted to weights using the <a href="#gen">weight-length relationship</a> found in the gerneral overview.</p>
<p>For each unique category we define</p>
<p><span class="math display">\[expansion \; factor = \frac{landings \; of \; unclassifieds}{\sum landings \; of \; known \; market \; codes  } \]</span> Therefore the expanded weights of the unclassified sample</p>
<p><span class="math display">\[expanded \; unclassified\; weights \; = expansion \; factor \;*\; fish \; weights \; of \; known \; market \; codes\]</span></p>
</div>
</div>
</div>
<div id="discards" class="section level1">
<h1 class="hasAnchor">
<a href="#discards" class="anchor"></a>Discards</h1>
<p>Need to deal with discards in a similar fashion. It seems that Susan Wigley has a SAS script that most/some stock assessment scientists use to help with this. Edit: Spoke to Susan Wigley she says that they will have all of the discard estimates over time for all of the species in a database similar to that of the landings, length, age databases. This will make life heck of a lot simpler for us.</p>
</div>
<div id="nafo-data" class="section level1">
<h1 class="hasAnchor">
<a href="#nafo-data" class="anchor"></a>NAFO data</h1>
<p>Non US landings need to be integrated also.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Andy Beet, Laurel Smith, Sean Lucey.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
